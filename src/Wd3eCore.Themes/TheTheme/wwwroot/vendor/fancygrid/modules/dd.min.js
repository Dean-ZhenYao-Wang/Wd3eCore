!function(){var a=Fancy,b=a.GRID_BODY_CLS,c=a.GRID_CLS,d=a.GRID_CELL_CLS;a.define("Fancy.grid.plugin.GridToGrid",{extend:a.Plugin,ptype:"grid.dragdrop",inWidgetName:"dragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",dropHeaderMaskCls:"fancy-drop-header-mask",droppable:!0,dropZoneOverClass:b,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.addEvents("drop"),a.Super("init",arguments),a.initDropCls(),a.initEnterLeave(),a.ons()},initDropCls:function(){var a=this,b="."+a.dropGroup;b+=" ."+a.dropZoneOverClass,a.dropCls=b},addDragDropCls:function(){this.widget.el.addCls(this.dragGroup)},ons:function(){var a=this,b=a.widget;b.on("render",function(){a.addDragDropCls()}),a.dropGroup&&(b.on("beforecellmousedown",a.onBeforeCellMouseDown,a),b.on("cellmousedown",a.onCellMouseDown,a),b.on("cellleave",a.onCellLeave,a),b.on("cellenter",a.onCellEnter,a)),a.on("drop",a.onDropItems,a)},onDropItems:function(a,b){var c=this,d=c.widget,e=c.dropGrid,f=void 0===e.activeRowEnterIndex?e.getViewTotal():e.activeRowEnterIndex;d.fire("dropitems",b,f),c.onDrop&&c.onDrop.apply(d,[b,f])},onBeforeCellMouseDown:function(b,c){var d=this,e=d.widget,f=e.lang,g=a.get(document),h=e.getSelection();if((!c.e.ctrlKey||!0!==e.multiSelect)&&h.length>1){var i=!1;if(a.each(h,function(a){if(a.id===c.id)return i=!0,!0}),!1===i)return;e.stopSelection(),g.once("mouseup",d.onDocMouseUp,d),g.on("mousemove",d.onDocMouseMove,d),g.once("mouseup",function(){e.enableSelection()},d),h=e.getSelection();var j=a.String.format(f.dragText,[h.length,h.length>1?"s":""]);d.initTip(j),d.dragItems=e.getSelection(),d.cellMouseDown=!0}},onCellMouseDown:function(b,c){var d=this,e=d.widget,f=a.get(document);if(!1!==e.selection.enabled){c.e.ctrlKey&&!0===e.multiSelect||("$selected"===c.column.index||e.clearSelection(),f.once("mouseup",d.onDocMouseUp,d),f.on("mousemove",d.onDocMouseMove,d),d.cellMouseDown=!0,d.activeRowIndex=c.rowIndex)}},initEnterLeave:function(){var b=this,c=a.select(b.dropCls);if(0===c.length)return void setTimeout(function(){b.initEnterLeave()},500);c.on("mouseenter",b.onMouseEnterDropGroup,b),c.on("mouseleave",b.onMouseLeaveDropGroup,b)},onMouseEnterDropGroup:function(b){var d=this;if(d.cellMouseDown){var e=a.get(b.currentTarget);if(d.dropGrid=a.getWidget(e.closest("."+c).attr("id")),d.dropGrid&&d.dropGrid.dragdrop&&!1===d.dropGrid.dragdrop.droppable)return d.dropOK=!1,void(d.tip&&d.tip.el.replaceClass(d.dropOkCls,d.dropNotOkCls));d.setDropGridCellsMask(),d.dropGridEventInited||d.onsDropGrid(),e.addCls(d.dropZoneCls),d.dropOK=!0,d.tip&&d.tip.el.replaceClass(d.dropNotOkCls,d.dropOkCls)}},onMouseLeaveDropGroup:function(b){var c=this;c.cellMouseDown&&(a.get(b.currentTarget).removeCls(c.dropZoneCls),c.dropOK=!1,c.tip.el.replaceClass(c.dropOkCls,c.dropNotOkCls),c.clearCellsMask())},setDropGridCellsMask:function(){var a,b=this,c=b.dropGrid;c&&b.cellMouseDown&&(a=c.getTotal(),0===a?c.el.addCls(b.dropHeaderMaskCls):c.el.select("."+d+'[index="'+(a-1)+'"]').addCls(b.cellMaskCls))},onsDropGrid:function(){var a=this;a.dropGrid.on("rowenter",a.onDropGridRowEnter,a),a.dropGrid.on("rowleave",a.onDropGridRowLeave,a),a.dropGridEventInited=!0},onDropGridRowEnter:function(a,b){var c=this;!1===c.cellMouseDown&&(c.dropGrid.un("rowenter",c.onDropGridRowEnter),c.dropGrid.un("rowleave",c.onDropGridRowLeave)),c.clearCellsMask(),0===b.rowIndex?a.el.addCls(c.dropHeaderMaskCls):a.el.select("."+d+'[index="'+(b.rowIndex-1)+'"]').addCls(c.cellMaskCls),!1===c.cellMouseDown&&c.clearCellsMask(),c.dropGrid&&(c.dropGrid.activeRowEnterIndex=b.rowIndex)},onDropGridRowLeave:function(a,b){var c=this;c.clearCellsMask(),c.setDropGridCellsMask(),c.dropGrid&&delete c.dropGrid.activeRowEnterIndex},clearCellsMask:function(){var a=this,b=a.cellMaskCls;a.dropGrid&&(a.dropGrid.el.removeCls(a.dropHeaderMaskCls),a.dropGrid.el.select("."+b).removeCls(b))},onDocMouseUp:function(b){var c=this,d=c.widget,e=a.get(document);c.cellMouseDown=!1,c.tip&&c.tip.hide(),d.enableSelection(),e.un("mousemove",c.onDocMouseMove),!0===c.dropOK&&(d.clearSelection(),c.dropGrid.clearSelection(),c.fire("drop",c.dragItems)),delete c.dragItems,c.dropOK=!1,a.select("."+c.dropZoneCls).removeCls(c.dropZoneCls),c.clearCellsMask(),c.dropGrid&&(c.dropGrid.un("rowenter",c.onDropGridRowEnter),c.dropGrid.un("rowleave",c.onDropGridRowLeave)),delete c.dropGridEventInited},onDocMouseMove:function(a){this.dragItems&&this.tip.show(a.pageX+20,a.pageY+20)},onCellLeave:function(b,c){var d=this,e=d.widget,f=e.lang;setTimeout(function(){if(d.onceStopDrag)return void(d.onceStopDrag=!1);if(!0===d.cellMouseDown&&!d.dragItems){var b=e.getSelection(),g=a.String.format(f.dragText,[b.length,b.length>1?"s":""]);e.stopSelection(),d.initTip(g,c.e),d.tip.show(),d.tip.el.css("display","block"),d.dragItems=b}},1)},onCellEnter:function(a,b){var c=this;!0!==c.cellMouseDown||c.dragItems||b.rowIndex!==c.activeRowIndex&&(c.onceStopDrag=!0,c.activeRowIndex=b.rowIndex)},initTip:function(b,c){var d=this,e=d.dropNotOkCls;d.tip||(d.tip=new a.ToolTip({cls:e,text:b})),c&&d.tip.show(c.pageX+20,c.pageY+20),d.tip.update(b),d.tip.el.replaceClass(d.dropOkCls,e)}})}(),function(){var a=Fancy,b=a.GRID_BODY_CLS,c=(a.GRID_CLS,a.GRID_CELL_CLS),d=(a.GRID_ROW_DRAG_EL_CLS,a.GRID_CELL_SELECTED_CLS);a.define("Fancy.grid.plugin.RowDragDrop",{extend:a.Plugin,ptype:"grid.rowdragdrop",inWidgetName:"rowdragdrop",dropOK:!1,cellMaskCls:"fancy-drop-cell-mask",cellFirstRowMaskCls:"fancy-drop-cell-first-mask",dropZoneCls:"fancy-drop-zone-active",dropOkCls:"fancy-drop-ok",dropNotOkCls:"fancy-drop-not-ok",droppable:!0,dropZoneOverClass:b,tipShown:!1,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.addEvents("drop"),a.ons(),a.initDropCls(),a.initEnterLeave(),a.disableSelectionMove()},ons:function(){var a=this,b=a.widget;b.on("beforecellmousedown",a.onBeforeCellMouseDown,a),b.on("cellmousedown",a.onCellMouseDown,a),b.on("rowenter",a.onRowEnter,a),b.on("cellleave",a.onCellLeave,a),a.on("drop",a.onDrop,a)},disableSelectionMove:function(){this.widget.selection.disableSelectionMove()},showTip:function(a){var b=this;0!==b.widget.getSelection().length&&(b.tip||b.initTip(),b.updateTipText(),a&&b.tip.show(a.pageX+20,a.pageY+20),b.tipShown=!0)},hideTip:function(){var a=this;a.tip&&a.tip.hide(),a.tipShown=!1},onCellMouseDown:function(b,c){var d=this,e=(d.widget,a.get(document));d.cellMouseDown=a.get(c.cell),e.once("mouseup",d.onDocMouseUp,d)},onDocMouseUp:function(b){var c=this,d=c.widget,e=a.get(document);c.cellMouseDown=!1,c.mouseDownDragEl=!1,d.enableSelection(),c.tipShown&&(e.un("mousemove",c.onDocMouseMove),c.hideTip(),c.clearCellsMask(),c.dropOK&&c.fire("drop"),c.tipShown=!1)},onRowEnter:function(b,c){var e=this,f=e.widget,g=f.getSelection();if(e.cellMouseDown&&0!==g.length&&e.tipShown){if(0!==c.rowIndex){var h=c.rowIndex-1;if(f.body.getCell(h,0).hasClass(d))return e.dropOK=!1,e.clearCellsMask(),void delete e.activeRowIndex;if(f.body.getCell(c.rowIndex,0).hasClass(d)&&1===g.length)return e.dropOK=!1,e.clearCellsMask(),void delete e.activeRowIndex;if(g.length>1){var h,i=!0;if(a.each(g,function(a){if(void 0===h)return void(h=f.getRowById(a.id));var b=f.getRowById(a.id);if(h!==b-1)return i=!1,!0;h=b}),i&&f.body.getCell(c.rowIndex,0).hasClass(d))return e.dropOK=!1,e.clearCellsMask(),void delete e.activeRowIndex}e.dropOK=!0;var j=f.get(h);e.insertItem=j}else{if(f.body.getCell(c.rowIndex,0).hasClass(d)){if(!(g.length>1))return e.dropOK=!1,e.clearCellsMask(),void delete e.activeRowIndex;var h,i=!0;if(a.each(g,function(a){if(void 0===h)return void(h=f.getRowById(a.id));var b=f.getRowById(a.id);if(h!==b-1)return i=!1,!0;h=b}),i&&f.body.getCell(c.rowIndex,0).hasClass(d))return e.dropOK=!1,e.clearCellsMask(),void delete e.activeRowIndex;e.dropOK=!0}else e.dropOK=!0;e.insertItem=0}e.activeRowIndex=c.rowIndex,e.showCellsDropMask()}},onCellLeave:function(b,c){var e=this,f=a.get(document),g=a.get(c.cell);e.cellMouseDown&&(e.tipShown||g.hasClass(d)&&(e.tip||e.initTip(),e.updateTipText(),e.showTip(c.e),f.on("mousemove",e.onDocMouseMove,e)))},initTip:function(){var b=this,c=b.dropNotOkCls;b.tip||(b.tip=new a.ToolTip({cls:c,text:""}))},updateTipText:function(){var b=this,c=b.widget,d=c.lang,e=c.getSelection(),f=a.String.format(d.dragText,[e.length,e.length>1?"s":""]);b.tip.update(f),e.length&&0!=b.dropOK?b.tip.el.replaceClass(b.dropNotOkCls,b.dropOkCls):b.tip.el.replaceClass(b.dropOkCls,b.dropNotOkCls)},onDocMouseMove:function(a){var b=this;b.cellMouseDown&&b.cellMouseDown.hasClass(d)?b.showTip(a):b.hideTip()},showCellsDropMask:function(){var a=this,b=a.widget,d=a.activeRowIndex-1;a.clearCellsMask(),-1===d?b.el.select("."+c+'[index="0"]').addCls(a.cellFirstRowMaskCls):b.el.select("."+c+'[index="'+d+'"]').addCls(a.cellMaskCls)},clearCellsMask:function(){var a=this,b=a.widget;b.el.select("."+a.cellMaskCls).removeCls(a.cellMaskCls),b.el.select("."+a.cellFirstRowMaskCls).removeCls(a.cellFirstRowMaskCls)},onDrop:function(){var b,c=this,d=c.widget,e=d.getSelection();d.selection.memory||d.clearSelection(),d.remove(e),b=0===c.insertItem?0:d.getRowById(c.insertItem.id)+1,d.insert(b,e),a.each(e,function(a){var b=d.getRowById(a.id);d.flashRow(b)})},onBeforeCellMouseDown:function(a,b){var c=this,e=Fancy.get(document),f=c.widget,g=f.getSelection();"select"!==b.column.type&&("rowdrag"===b.column.type&&(Fancy.get(b.cell).hasClass(d)||f.selectRow(b.rowIndex),c.mouseDownDragEl=!0,e.once("mousemove",function(a){c.showTip(a),e.on("mousemove",c.onDocMouseMove,c)})),Fancy.get(b.cell).hasClass(d)&&g.length>1&&f.stopSelection())},initDropCls:function(){var a=this,b=a.widget,c="#"+b.id+" ."+a.dropZoneOverClass;a.dropCls=c},initEnterLeave:function(){var b=this,c=a.select(b.dropCls);if(0===c.length)return void setTimeout(function(){b.initEnterLeave()},500);c.on("mouseleave",b.onMouseLeaveDropGroup,b)},onMouseLeaveDropGroup:function(){var a=this;a.dropOK=!1,a.clearCellsMask()}})}();